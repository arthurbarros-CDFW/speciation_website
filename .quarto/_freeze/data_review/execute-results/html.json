{
  "hash": "a2a34ac0aff1f65539c608030815428a",
  "result": {
    "markdown": "---\ntitle: \"Simulating Sonar Data\"\n\nbibliography: references/references.bib\nlink-citations: TRUE\n---\n\n\nBefore we review speciation methods, we can set the baseline of what our\nsonar data set will look like. For a given period of survey, we can\nexpect to have a data set that tells us the date, and the net movement\nof detections. For the examples in this document I'll be simulating both\nsonar and auxiliary data sets for ease of use and replication. I'll give\na general outline in this section on how the data is simulated.\n\nThere a few R packages used in this documentation that can be loaded\nhere:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#load packages\nrm( list = ls()) #clear env\nlibrary(tidyverse) #for piping and data formatting ease\nlibrary(ggplot2) #for plotting\nlibrary(lubridate) #makes formatting dates a little easier\nlibrary(caret) #provides the createDataPartition() call for testing/training\nlibrary(nnet) #for multi-nomial regression\nlibrary(mclust) #for gaussian mixed models\n```\n:::\n\n\nWe'll start by simulating a simpler sonar detection data set that\ninvolves two species with overlapping distributions of run timing. First\nwe can simulate our fish movement data as having runs with normal\ndistributions centered around two peak dates, which we'll define as\n`peakA` and `peakB`. We'll also make these dates and the date range\nnumeric values so we can build distributions from them.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Identify peaks\npeakA <- as.numeric(as.Date(\"2023-11-10\")) \npeakB <- as.numeric(as.Date(\"2024-01-12\"))\n```\n:::\n\n\nWe can then create normal distributions of movement data centered around\nour peaks, and combine the data into one data set `combined_counts`,\nwhich we can then turn back into a date format for easy plotting. For\nthis example we'll also assign each record a \"true\" species\nidentification which we can use to test the accuracy of our methods.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simulate counts around the peaks using normal distributions \nset.seed(42)  # For reproducibility \nnA=1000\nnB=850\ncountsA <- data.frame(species=\"A\",\n                      date=round(rnorm(n=nA, mean = peakA, sd = 22)))\ncountsB <- data.frame(species=\"B\",\n                      date=round(rnorm(n=nA, mean = peakB, sd = 20)))  \n# Combine the counts \ncombined_counts <- countsA%>%rbind(countsB)\n#combine distributions \ncombined_counts$date<-as.Date(combined_counts$date,origin = \"1970-01-01\") \n```\n:::\n\n\nNext we'll convert the data into the `daily_sonar` data frame and do\nsome additional formatting.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a dataframe with counts \ndaily_sonar <- combined_counts%>%\n  group_by(species,date)%>%\n  tally()\nnames(daily_sonar) <- c(\"species\",\"date\", \"Net_Movement\")  \n```\n:::\n\n\nNow we can bin daily counts by week for easier plotting and\nvisualization.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Bin the dates by week \ndaily_sonar$Week <- as.Date(cut(daily_sonar$date, breaks = \"week\",  \n                                start.on.monday = TRUE))\n```\n:::\n\n\nOur final `daily_sonar` data frame contains four columns: the \"true\"\n`species` ID we gave the count, the `date` of the observation, the\n`Net_Movement` (essentially count in this case), and the week. Remember\nthat while we gave each simulated observation a \"true\" species code,\neither A or B, we wouldn't actually know that information in our real\nsonar data sets. We will be using the simulated species ID to test our\nspeciation methods accuracy in the following sections.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(daily_sonar)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 Ã— 4\n# Groups:   species [1]\n  species date       Net_Movement Week      \n  <chr>   <date>            <int> <date>    \n1 A       2023-08-28            1 2023-08-28\n2 A       2023-09-05            2 2023-09-04\n3 A       2023-09-06            1 2023-09-04\n4 A       2023-09-12            1 2023-09-11\n5 A       2023-09-13            1 2023-09-11\n6 A       2023-09-15            1 2023-09-11\n```\n:::\n:::\n\n\nLet's plot the sonar data to see how it's distributed over our simulated\nsurvey period. We see two run peaks centered around the dates we set,\nand what looks like quite a bit of overlap in the the simulated\ndetection timing.\n\n\n::: {.cell height='4'}\n::: {.cell-output-display}\n![Plot showing distribution of simulated sonar net movement detections.](data_review_files/figure-html/sonar data simulation plot-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n:::\n",
    "supporting": [
      "data_review_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "afdf88d93d9d4dcafe1c41a706349bf8",
  "result": {
    "markdown": "---\ntitle: \"In-season Cutoff\"\n\nbibliography: references/references.bib\nlink-citations: TRUE\n---\n\n\nPerhaps the simplest method to speciate between two different fish\nspecies in a study would be to incorporate historical run-time and\ncatch/escapement data proximate to the sonar study area in a method we\ncan refer to as an \"in-season cutoff\"[@Nolan2023]. Here we'll simulate\nsome historical auxiliary count data for two different species, \"A\" and\n\"B\", using the same methods as above to get the following `weekly_aux`\ndata.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(weekly_aux)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 Ã— 3\n  Week       species Total_Count\n  <date>     <chr>         <int>\n1 2009-09-21 A                 2\n2 2009-09-28 A                 6\n3 2009-10-05 A                14\n4 2009-10-12 A                25\n5 2009-10-19 A                31\n6 2009-10-26 A                58\n```\n:::\n:::\n\n\nThis auxiliary data set shows the weekly counts of our two target\nspecies for a run 13 years prior to our sonar data at a proximate\nlocation. Obviously a more proximate (in both space and time) auxiliary\ndata set could be more representative of our sonar samples, and thus\nmore applicable. However, often the auxiliary data available is not the\nmost optimal, and so we have to use the best data available.\n\nThis historical data set can be used to produce an \"in-season cutoff\",\nessentially finding a date in the historical data when the proportion of\nspecies B is greater than species A. We can then apply that date to our\nsonar data, and assign any fish observed before that date as \"A\" and\nafter as \"B\". To utilize an \"in-season cutoff\" we need to find the week\nwhen the proportion of species B captured was higher than the count of\nspecies A. We can use the following code to first estimate the\nproportion of each species for each week fish were caught:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate proportions and reshape in one step\nproportions_combined <- weekly_aux %>%\n  group_by(Week) %>%\n  mutate(total_n = sum(Total_Count)) %>%\n  mutate(proportion = Total_Count / total_n) %>%\n  select(Week, species, proportion) %>%\n  pivot_wider(names_from = species,\n              values_from = proportion,\n              names_prefix = \"proportion_\") %>%\n  ungroup()\n```\n:::\n\n\nNow we can easily find the first week in our data when the count of\nspecies B is greater than species A.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find the first week where the proportion of species A is greater than B\nresult <- proportions_combined %>%\n  filter(proportion_B > proportion_A) %>%\n  slice(1)\n\nresult_week <- result$Week\n\n# Output the first week\nresult_week\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2009-12-07\"\n```\n:::\n:::\n\n\nThe above shows us that 2009-12-07 was the first week in which the\ncount of species B was greater than the count of A in our auxiliary\ndata.\n\nWe can plot the distribution of the data here along with our cutoff:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Plot showing species counts of auxiliary historical hatchery data set. Dashed line represents 'in-season cutoff'.](inseason_cutoff_files/figure-html/hatchery_sim_plot_historic-1.png){width=672}\n:::\n:::\n\n\nUsing this historical auxiliary data set, we can decide to set our\ncutoff to the date of 2009-12-07, and assign any fish detection in\nour sonar data before that date as species A, and any after as species\nB.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntarget_year<-2023\ncutoff_date<-as.Date(paste(target_year,\n                           month(result_week),day(result_week),sep=\"-\"))\n\ndaily_sonar<-daily_sonar\ndaily_sonar$predicted_species<-\n  ifelse(daily_sonar$date<cutoff_date,'A','B')\n```\n:::\n\n\nWe can now plot our sonar data and show the species assignments.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Plot showing species assignments of sonar data using the 'In-season cutoff' method](inseason_cutoff_files/figure-html/cutoff_assign_plot-1.png){width=672}\n:::\n:::\n\n\nFinally we can estimate counts for each species in our sonar data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nN_est<-daily_sonar%>%\n  group_by(predicted_species)%>%\n  summarise(total=sum(Net_Movement))\n```\n:::\n\n\nWith the above snippet we can see that our final estimates of sonar\ncounts are 922 for species A and 1078 for species\nB. We know that our simulated data had a count of 116 for\nspecies A and 103 for species B, so we had an error rate\nof -694.8275862%.\n\nThe above method of speciation, while simple, provides a straightforward\napproach for leveraging historical data to infer species composition in\nsonar detection studies. Key assumptions to realize when utilizing this\nmethod are:\n\n-   All fish being speciated are either one of two species.\n\n-   There is no overlap in run timing.\n\n-   Date based threshold of the auxiliary data is representative of the\n    sonar site.\n\n-   Date based threshold used is consistent between years.\n\nReal world systems will likely violate one or more of the above\nassumptions, so the use of this method is likely to bias species\nidentifications and resulting count estimates. Our simulation had an\noverlap in run timing and variation in the distributions that resulted\nin an over-count of species B and an under-count of species A.\n \n",
    "supporting": [
      "inseason_cutoff_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}